# 横向格式菜单餐次分类需求文档

## 介绍

本文档规定了食堂菜单系统在处理横向格式（星期格式）Excel文件时的餐次分类需求。当前系统在解析横向格式菜单时只能识别单一餐次，无法正确区分早餐、午餐、晚餐，导致1月菜单文件没有按照餐次进行分类显示。

## 问题背景

当前1月菜单文件`省投食堂菜单：1月4日-9日.xlsx`使用横向格式（星期作为列，菜品分类作为行），但系统解析后所有菜品都被归类为同一餐次，没有区分早餐、午餐、晚餐。

## 术语表

- **横向格式**: 星期作为列标题，菜品分类作为行的Excel布局格式
- **餐次分类**: 将菜品按照早餐、午餐、晚餐进行分组
- **智能餐次推断**: 基于菜品分类或其他标识自动识别餐次的算法
- **分类行标识**: 用于区分不同餐次的特殊行标记
- **餐次分隔符**: 在Excel中用于分隔不同餐次的标识符

## Requirements

### 需求 1

**用户故事:** 作为用户，我希望横向格式的菜单能够正确显示早餐、午餐、晚餐分类，以便我能够清楚地看到每餐的菜品安排。

#### 验收标准

1. 当解析横向格式菜单时，系统应能够识别多个餐次分组
2. 当菜单包含早餐、午餐、晚餐时，系统应正确分类显示
3. 当餐次之间有明确分隔符时，系统应准确识别分隔点
4. 当显示菜单时，应按照早餐、午餐、晚餐的顺序排列
5. 当某个餐次没有菜品时，系统应优雅处理而不显示空餐次

### 需求 2

**用户故事:** 作为系统开发者，我希望有智能的餐次推断算法，以便处理各种不同的横向格式菜单布局。

#### 验收标准

1. 当Excel中有明确的餐次标识时，系统应优先使用明确标识
2. 当缺少明确餐次标识时，系统应基于菜品分类智能推断
3. 当遇到"类别"行时，系统应将其作为餐次分隔的标志
4. 当分析菜品分类时，系统应识别早餐、午餐、晚餐的典型特征
5. 当推断结果不确定时，系统应提供合理的默认分组

### 需求 3

**用户故事:** 作为食堂管理员，我希望系统能够处理不同风格的横向菜单格式，以便适应各种Excel模板。

#### 验收标准

1. 当菜单使用空行分隔餐次时，系统应识别空行作为分隔符
2. 当菜单使用特殊标记分隔餐次时，系统应识别这些标记
3. 当菜单混合使用多种分隔方式时，系统应综合判断
4. 当处理复杂布局时，系统应保持解析的准确性
5. 当遇到不规范格式时，系统应提供有意义的错误信息

### 需求 4

**用户故事:** 作为用户，我希望横向格式菜单的餐次时间设置合理，以便了解用餐时间安排。

#### 验收标准

1. 当识别为早餐时，系统应设置合适的早餐时间（如7:30）
2. 当识别为午餐时，系统应设置合适的午餐时间（如12:00）
3. 当识别为晚餐时，系统应设置合适的晚餐时间（如18:00）
4. 当时间设置可配置时，系统应支持自定义餐次时间
5. 当显示菜单时，时间信息应清晰准确

### 需求 5

**用户故事:** 作为测试工程师，我希望餐次分类功能有完整的测试覆盖，以便确保功能的稳定性和准确性。

#### 验收标准

1. 当测试各种横向格式时，餐次识别应准确无误
2. 当测试边界情况时，系统应正确处理异常情况
3. 当验证推断算法时，应覆盖各种菜品分类组合
4. 当测试兼容性时，应确保不影响其他格式的解析
5. 当运行回归测试时，现有功能应保持正常

## 技术约束

### 算法复杂度
- 餐次推断算法应保持O(n)复杂度，其中n为行数
- 不应显著增加文件解析时间
- 内存使用量应保持在合理范围内

### 兼容性要求
- 保持与现有纵向格式解析的兼容性
- 不影响其他Excel格式的正常解析
- API接口保持向后兼容

### 准确性要求
- 餐次识别准确率应达到95%以上
- 对于标准格式菜单，准确率应达到100%
- 提供人工干预和修正机制

## 常见餐次分类模式

### 基于分类名称的推断
1. **早餐特征分类**: 粥品、包点、豆浆、油条、煎蛋等
2. **午餐特征分类**: 荤菜、素菜、汤品、主食等
3. **晚餐特征分类**: 清淡菜品、汤品、小菜等

### 基于分隔符的识别
1. **明确标识**: "早餐"、"午餐"、"晚餐"文字标记
2. **类别行**: "类别"行作为餐次分隔标志
3. **空行分隔**: 连续空行作为餐次分界
4. **特殊标记**: 其他自定义分隔标记

### 基于位置的推断
1. **顺序规律**: 通常按早餐→午餐→晚餐顺序排列
2. **分组数量**: 根据分组数量推断餐次数量
3. **行数分布**: 根据每组行数推断餐次类型

## 边界情况处理

### 数据异常
1. **缺少餐次标识**: 完全没有明确的餐次分隔
2. **混合格式**: 同一文件中混合多种格式
3. **不规范布局**: 不符合常见模式的特殊布局

### 推断冲突
1. **多重标识**: 同时存在多种餐次标识方式
2. **标识错误**: 餐次标识与实际内容不符
3. **分类模糊**: 菜品分类无法明确归属餐次

### 性能考虑
1. **大文件处理**: 包含大量数据的Excel文件
2. **复杂布局**: 结构复杂的菜单格式
3. **批量处理**: 同时处理多个文件的情况

## 成功标准

### 功能完整性
- 横向格式菜单正确分类为早午晚餐
- 所有餐次显示完整的菜品信息
- 用户界面清晰展示餐次分组

### 技术指标
- 餐次识别准确率≥95%
- 文件解析时间增加<20%
- 内存使用量增加<10%

### 用户体验
- 菜单显示直观清晰
- 餐次分组逻辑合理
- 错误提示友好明确