# 跨年日期处理需求文档

## 介绍

本文档规定了食堂菜单系统处理跨年菜单文件的需求。当前系统在处理跨年菜单时存在年份判断错误，需要实现智能的年份推断机制，确保12月菜单正确识别为上一年，1月菜单正确识别为当前年。

## 问题背景

现在是2026年1月，menu目录下包含：
- 12月文件：应该是2025年12月的数据
- 1月文件：应该是2026年1月的数据

当前系统使用`current_year()`函数统一处理所有文件，导致12月菜单被错误标记为2026年12月，造成日期混乱。

## 术语表

- **跨年菜单**: 包含不同年份月份的菜单文件集合
- **年份推断**: 根据月份和当前时间智能判断菜单所属年份的算法
- **日期范围验证**: 确保解析出的日期在合理范围内的验证机制
- **文件名解析**: 从Excel文件名中提取日期信息的功能
- **时间窗口**: 用于年份判断的时间范围策略

## Requirements

### 需求 1

**用户故事:** 作为系统管理员，我希望系统能够正确处理跨年菜单文件，以便用户看到准确的菜单日期。

#### 验收标准

1. 当解析12月菜单文件时，系统应将其识别为上一年的12月数据
2. 当解析1月菜单文件时，系统应将其识别为当前年的1月数据
3. 当同时存在12月和1月文件时，系统应正确区分年份
4. 当显示菜单日期时，应显示完整的年-月-日格式
5. 当用户浏览菜单时，日期导航应跨越年份边界正常工作

### 需求 2

**用户故事:** 作为开发者，我希望年份推断逻辑是智能和可配置的，以便适应不同的使用场景。

#### 验收标准

1. 当当前时间是1-6月时，12月文件应被识别为上一年
2. 当当前时间是7-12月时，1月文件应被识别为下一年
3. 当文件名包含明确年份时，应优先使用文件名中的年份
4. 当年份推断存在歧义时，应提供清晰的错误信息
5. 当配置年份推断策略时，应支持自定义时间窗口

### 需求 3

**用户故事:** 作为用户，我希望在跨年期间查看菜单时体验流畅，不会出现日期错乱。

#### 验收标准

1. 当从12月最后一天导航到1月第一天时，应正确跨年
2. 当查看月历时，应正确显示跨年的日期标记
3. 当搜索特定日期菜单时，应考虑年份信息
4. 当显示"今日菜单"时，应准确匹配当前日期
5. 当菜单数据跨年时，日期排序应保持正确顺序

### 需求 4

**用户故事:** 作为测试工程师，我希望跨年日期处理逻辑有完整的测试覆盖，以便确保功能稳定性。

#### 验收标准

1. 当运行跨年测试用例时，所有边界情况应被覆盖
2. 当模拟不同时间点时，年份推断应始终正确
3. 当测试文件名解析时，应包含各种日期格式
4. 当验证日期范围时，应检查合理性边界
5. 当测试时区影响时，应确保年份判断不受时区偏移影响

### 需求 5

**用户故事:** 作为系统维护者，我希望有清晰的日志和错误处理，以便快速诊断跨年相关问题。

#### 验收标准

1. 当年份推断发生时，应记录详细的推断过程日志
2. 当发现日期异常时，应提供具体的错误信息
3. 当文件解析失败时，应明确指出年份相关的问题
4. 当系统启动时，应验证现有菜单数据的年份一致性
5. 当监控系统运行时，应提供跨年处理的统计信息

## 技术约束

### 年份推断策略
- 基于当前月份的智能推断
- 支持文件名中明确年份的优先级
- 提供可配置的时间窗口策略

### 兼容性要求
- 保持现有API接口不变
- 向后兼容已有的菜单数据
- 不影响单年份菜单的处理逻辑

### 性能要求
- 年份推断算法复杂度应为O(1)
- 不显著增加文件解析时间
- 内存使用量不应明显增加

## 边界情况处理

### 时间边界
1. **新年前后**: 12月31日到1月1日的跨年处理
2. **月份边界**: 11月到12月，12月到1月的月份跨越
3. **闰年处理**: 2月29日的特殊日期处理

### 文件名格式
1. **不同日期格式**: 支持多种中文和数字日期格式
2. **缺少年份**: 文件名中只有月日信息的处理
3. **模糊日期**: 日期范围跨月或跨年的处理

### 数据一致性
1. **重复日期**: 同一日期在不同文件中出现的处理
2. **日期间隙**: 菜单数据中缺少某些日期的处理
3. **未来日期**: 超出合理范围的未来日期处理

## 成功标准

### 功能完整性
- 所有跨年场景正确处理
- 用户体验无缝衔接
- 数据准确性100%

### 技术指标
- 年份推断准确率100%
- 文件解析成功率不下降
- API响应时间不增加

### 用户体验
- 日期导航流畅自然
- 错误信息清晰易懂
- 菜单显示准确无误